<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAX</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MAX">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="MAX">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-TileImage" content="icons/icon-144.png">
    
    <!-- Icons -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/icon-120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="icons/icon-72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="icons/icon-72.png">
    <link rel="apple-touch-icon" href="icons/icon-180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-72.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">
    <link rel="shortcut icon" href="icons/icon-72.png">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        /* Light theme (default) */
        body {
            background: linear-gradient(180deg, #E8E5FF 0%, #F5F3FF 100%);
            color: #1a1a1a;
        }
        
        /* Dark theme */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
                color: #ffffff;
            }
            
            .phone-input-container {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
            }
            
            .country-selector {
                background: rgba(255, 255, 255, 0.05);
                border-right: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .phone-input {
                color: #ffffff;
            }
            
            .phone-input::placeholder {
                color: rgba(255, 255, 255, 0.6);
            }
            
            .title {
                color: #ffffff !important;
            }
            
            .subtitle {
                color: rgba(255, 255, 255, 0.8) !important;
            }
            
            .help-icon {
                background: rgba(255, 255, 255, 0.1);
                color: rgba(255, 255, 255, 0.7);
            }
            
            .logo-text {
                color: #ffffff !important;
            }
            
            .privacy-notice {
                color: rgba(255, 255, 255, 0.7);
            }
            
            .country-code {
                color: #ffffff;
            }
        }
        
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 400px;
            width: 100%;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 40px;
            position: relative;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background-image: url('icons/max_logo.webp');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo-text {
            font-size: 24px;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .help-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .title {
            font-size: 28px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 12px;
            line-height: 1.3;
        }
        
        .subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 40px;
            font-weight: 400;
        }
        
        .phone-input-container {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 0;
            margin-bottom: 40px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .country-selector {
            display: flex;
            align-items: center;
            padding: 16px 12px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            gap: 8px;
            cursor: pointer;
            min-width: 80px;
        }
        
        .flag {
            width: 24px;
            height: 18px;
            border-radius: 2px;
        }
        
        .country-code {
            font-size: 16px;
            font-weight: 500;
            color: #1a1a1a;
        }
        
        .dropdown-arrow {
            margin-left: 4px;
        }
        
        .phone-input {
            flex: 1;
            border: none;
            outline: none;
            padding: 16px;
            font-size: 16px;
            background: transparent;
            color: #1a1a1a;
        }
        
        .phone-input::placeholder {
            color: #999;
        }
        
        .bottom-section {
            padding-bottom: 40px;
        }
        
        .continue-button {
            width: 100%;
            padding: 16px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background-color 0.2s;
        }
        
        .continue-button:hover {
            background: #0056CC;
        }
        
        .continue-button:disabled {
            background: #666 !important;
            cursor: not-allowed !important;
            opacity: 0.6 !important;
        }
        
        .privacy-notice {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
            text-align: center;
            padding: 0 20px;
        }
        
        .privacy-link {
            color: #007AFF;
            text-decoration: none;
        }
        
        .privacy-link:hover {
            text-decoration: underline;
        }
        
        /* iOS-style modal */
        .ios-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        /* Android Material Design modal */
        .android-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .ios-modal-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 14px;
            padding: 0;
            max-width: 320px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            animation: modalSlideIn 0.3s ease-out;
            overflow: hidden;
        }

        .android-modal-content {
            background: #ffffff;
            border-radius: 8px;
            padding: 0;
            max-width: 340px;
            width: 90%;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            animation: androidModalSlideIn 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .ios-modal-header {
            padding: 20px 20px 10px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .ios-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #000;
            margin: 0 0 8px 0;
        }

        .ios-modal-message {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
            margin: 0;
        }

        .android-modal-header {
            padding: 24px 24px 20px;
            text-align: left;
        }

        .android-modal-title {
            font-size: 20px;
            font-weight: 500;
            color: #212121;
            margin: 0 0 16px 0;
            font-family: 'Roboto', sans-serif;
        }

        .android-modal-message {
            font-size: 16px;
            color: #757575;
            line-height: 1.5;
            margin: 0;
            font-family: 'Roboto', sans-serif;
        }
        
        .ios-modal-body {
            padding: 15px 20px;
            text-align: center;
            background: rgba(248, 248, 248, 0.8);
        }

        .ios-modal-error-code {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 12px;
            color: #999;
            background: rgba(0, 0, 0, 0.05);
            padding: 8px 12px;
            border-radius: 8px;
            margin: 10px 0;
            display: inline-block;
        }

        .android-modal-body {
            padding: 0 24px 8px;
            text-align: left;
        }

        .android-modal-error-code {
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
            color: #616161;
            background: #f5f5f5;
            padding: 12px 16px;
            border-radius: 4px;
            margin: 16px 0 0 0;
            display: block;
            border-left: 4px solid #f44336;
        }
        
        .ios-modal-buttons {
            display: flex;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .ios-modal-button {
            flex: 1;
            padding: 16px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .ios-modal-button:first-child {
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            color: #007AFF;
        }

        .ios-modal-button:last-child {
            color: #FF3B30;
            font-weight: 600;
        }

        .ios-modal-button:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .android-modal-buttons {
            display: flex;
            justify-content: flex-end;
            padding: 8px 16px 16px;
            gap: 8px;
        }

        .android-modal-button {
            padding: 10px 16px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
            text-transform: uppercase;
            font-family: 'Roboto', sans-serif;
            min-width: 64px;
        }

        .android-modal-button.primary {
            color: #1976d2;
        }

        .android-modal-button.secondary {
            color: #f44336;
        }

        .android-modal-button:hover {
            background: rgba(0, 0, 0, 0.04);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes androidModalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        /* Dark theme modal adjustments */
        @media (prefers-color-scheme: dark) {
            .ios-modal-content {
                background: rgba(44, 44, 46, 0.95);
            }
            
            .ios-modal-title {
                color: #ffffff;
            }
            
            .ios-modal-message {
                color: rgba(255, 255, 255, 0.8);
            }
            
            .ios-modal-body {
                background: rgba(28, 28, 30, 0.8);
            }
            
            .ios-modal-error-code {
                color: rgba(255, 255, 255, 0.6);
                background: rgba(255, 255, 255, 0.1);
            }
            
            .ios-modal-buttons {
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .ios-modal-button:first-child {
                border-right: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .ios-modal-button:hover {
                background: rgba(255, 255, 255, 0.1);
            }

            .android-modal-content {
                background: #424242;
            }
            
            .android-modal-title {
                color: #ffffff;
            }
            
            .android-modal-message {
                color: rgba(255, 255, 255, 0.87);
            }
            
            .android-modal-error-code {
                color: rgba(255, 255, 255, 0.7);
                background: #616161;
                border-left-color: #f44336;
            }
            
            .android-modal-button:hover {
                background: rgba(255, 255, 255, 0.08);
            }
        }
        
        /* Responsive design */
        @media (max-width: 480px) {
            .container {
                padding: 0 16px;
            }
            
            .title {
                font-size: 24px;
            }
            
            .header {
                margin-bottom: 20px;
            }
            
            .main-content {
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo-icon"></div>
                <span class="logo-text">MAX</span>
            </div>
            <div class="help-icon">?</div>
        </div>
        
        <div class="main-content">
            <h1 class="title">С каким номером<br>телефона хотите войти?</h1>
            <p class="subtitle">На него придёт СМС с кодом</p>
            
            <div class="phone-input-container">
                <div class="country-selector">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjYiIGZpbGw9IndoaXRlIi8+CjxyZWN0IHk9IjYiIHdpZHRoPSIyNCIgaGVpZ2h0PSI2IiBmaWxsPSIjMDA1MkZGIi8+CjxyZWN0IHk9IjEyIiB3aWR0aD0iMjQiIGhlaWdodD0iNiIgZmlsbD0iI0ZGMDAwMCIvPgo8L3N2Zz4K" alt="RU" class="flag">
                    <span class="country-code">+7</span>
                    <svg class="dropdown-arrow" width="12" height="8" viewBox="0 0 12 8" fill="none">
                        <path d="M1 1L6 6L11 1" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <input type="tel" class="phone-input" placeholder="123 456-78-90" maxlength="13">
            </div>
        </div>
        
        <div class="bottom-section">
            <button class="continue-button">Продолжить</button>
            
            <div class="privacy-notice">
                Нажимая «Продолжить», вы принимаете <a href="#" class="privacy-link">политику конфиденциальности</a> и <a href="#" class="privacy-link">пользовательское соглашение</a>
            </div>
        </div>
    </div>
    
    <!-- iOS-style crash modal -->
    <div class="ios-modal" id="crashModal">
        <div class="ios-modal-content">
            <div class="ios-modal-header">
                <div class="ios-modal-title">MAX перестал работать</div>
                <div class="ios-modal-message">Произошёл сбой в приложении (ошибка #4A7B-9C2E), обратитесь к разработчику приложения</div>
            </div>
            <div class="ios-modal-body">
                <div class="ios-modal-error-code">Код ошибки: EXC_BAD_ACCESS (0x4A7B9C2E)</div>
            </div>
            <div class="ios-modal-buttons">
                <button class="ios-modal-button" onclick="sendReport()">Отправить отчёт</button>
                <button class="ios-modal-button" onclick="closeCrashModal()">Закрыть</button>
            </div>
        </div>
    </div>
    
    <!-- Second error modal -->
    <div class="ios-modal" id="secondErrorModal">
        <div class="ios-modal-content">
            <div class="ios-modal-header">
                <div class="ios-modal-title">Что-то пошло не так</div>
                <div class="ios-modal-message">Не удалось отправить СМС. Проверьте подключение к интернету и попробуйте снова</div>
            </div>
            <div class="ios-modal-body">
                <div class="ios-modal-error-code">Код ошибки: NET_TIMEOUT (0x2F8A1B3C)</div>
            </div>
            <div class="ios-modal-buttons">
                <button class="ios-modal-button" onclick="retryAction()">Повторить</button>
                <button class="ios-modal-button" onclick="closeSecondError()">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Android crash modal -->
    <div class="android-modal" id="androidCrashModal">
        <div class="android-modal-content">
            <div class="android-modal-header">
                <div class="android-modal-title">MAX остановлен</div>
                <div class="android-modal-message">К сожалению, приложение MAX было остановлено из-за неожиданной ошибки. Вы можете отправить отчёт разработчику для устранения проблемы.</div>
            </div>
            <div class="android-modal-body">
                <div class="android-modal-error-code">java.lang.RuntimeException: Fatal exception in main thread
at com.max.app.MainActivity.onCreate(MainActivity.java:42)
Caused by: android.content.res.Resources$NotFoundException</div>
            </div>
            <div class="android-modal-buttons">
                <button class="android-modal-button secondary" onclick="closeAndroidCrashModal()">Закрыть</button>
                <button class="android-modal-button primary" onclick="sendAndroidReport()">Отправить отчёт</button>
            </div>
        </div>
    </div>

    <!-- Android second error modal -->
    <div class="android-modal" id="androidSecondErrorModal">
        <div class="android-modal-content">
            <div class="android-modal-header">
                <div class="android-modal-title">Ошибка сети</div>
                <div class="android-modal-message">Не удалось отправить SMS-сообщение. Проверьте подключение к интернету и повторите попытку.</div>
            </div>
            <div class="android-modal-body">
                <div class="android-modal-error-code">NetworkException: Connection timeout
at com.max.network.SmsService.sendSms(SmsService.java:127)
Error code: NETWORK_TIMEOUT_ERROR</div>
            </div>
            <div class="android-modal-buttons">
                <button class="android-modal-button secondary" onclick="closeAndroidSecondError()">Отмена</button>
                <button class="android-modal-button primary" onclick="retryAndroidAction()">Повторить</button>
            </div>
        </div>
    </div>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(registration => console.log('SW registered'))
                .catch(error => console.log('SW registration failed'));
        }
        
        // Handle theme changes
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        
        function handleThemeChange(e) {
            // Update theme-color meta tag
            const themeColorMeta = document.querySelector('meta[name="theme-color"]');
            if (e.matches) {
                // Dark theme
                themeColorMeta.content = '#1a1a2e';
            } else {
                // Light theme
                themeColorMeta.content = '#667eea';
            }
        }
        
        // Listen for theme changes
        mediaQuery.addListener(handleThemeChange);
        
        // Set initial theme
        handleThemeChange(mediaQuery);
        
        // OS detection (hidden from user)
        document.addEventListener('DOMContentLoaded', function() {
            const os = getOperatingSystem();
            // OS detection works silently in background
        });
        
        // Auto crash simulation after page load
        setTimeout(() => {
            showCrashModal();
            
            // Show OS-appropriate notification
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
        }, 3000);
        
        // Phone input functionality
        const phoneInput = document.querySelector('.phone-input');
        const continueButton = document.querySelector('.continue-button');
        
        // Set button as disabled initially
        continueButton.disabled = true;
        continueButton.style.background = '#666';
        
        // Phone number formatting
        function formatPhoneNumber(value) {
            // Remove all non-digits
            const digits = value.replace(/\D/g, '');
            
            // Format as XXX XXX-XX-XX (10 digits total)
            if (digits.length <= 3) {
                return digits;
            } else if (digits.length <= 6) {
                return digits.slice(0, 3) + ' ' + digits.slice(3);
            } else if (digits.length <= 8) {
                return digits.slice(0, 3) + ' ' + digits.slice(3, 6) + '-' + digits.slice(6);
            } else if (digits.length <= 10) {
                return digits.slice(0, 3) + ' ' + digits.slice(3, 6) + '-' + digits.slice(6, 8) + '-' + digits.slice(8);
            } else {
                // Limit to 10 digits
                return digits.slice(0, 3) + ' ' + digits.slice(3, 6) + '-' + digits.slice(6, 8) + '-' + digits.slice(8, 10);
            }
        }
        
        // Phone input event listeners
        phoneInput.addEventListener('input', function(e) {
            const formatted = formatPhoneNumber(e.target.value);
            e.target.value = formatted;
            
            // Enable/disable continue button based on full phone number
            const digits = formatted.replace(/\D/g, '');
            console.log('Digits entered:', digits, 'Length:', digits.length); // Debug info
            
            if (digits.length === 10) {
                continueButton.disabled = false;
                continueButton.style.background = '#007AFF';
                continueButton.style.opacity = '1';
                console.log('Button activated!'); // Debug info
            } else {
                continueButton.disabled = true;
                continueButton.style.background = '#666';
                continueButton.style.opacity = '0.6';
                console.log('Button disabled, need', (10 - digits.length), 'more digits'); // Debug info
            }
        });
        
        // Second error simulation after phone input
        continueButton.addEventListener('click', function() {
            if (!this.disabled) {
                const phoneNumber = phoneInput.value.replace(/\D/g, '');
                console.log('Phone number:', '+7' + phoneNumber);
                
                // Show loading state
                this.textContent = 'Отправляем СМС...';
                this.disabled = true;
                this.style.background = '#666';
                
                // Simulate second error after 2 seconds
                setTimeout(() => {
                    showSecondError();
                    
                    // Reset button
                    this.textContent = 'Продолжить';
                    this.disabled = false;
                    this.style.background = '#007AFF';
                    
                    // Vibration if supported
                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200]);
                    }
                }, 2000);
            }
        });
        
        // OS-specific modal functions
        function showCrashModal() {
            const os = getOperatingSystem();
            if (os === 'android') {
                document.getElementById('androidCrashModal').style.display = 'flex';
            } else {
                // Default to iOS style for iOS and desktop
                document.getElementById('crashModal').style.display = 'flex';
            }
        }
        
        function showSecondError() {
            const os = getOperatingSystem();
            if (os === 'android') {
                document.getElementById('androidSecondErrorModal').style.display = 'flex';
            } else {
                // Default to iOS style for iOS and desktop
                document.getElementById('secondErrorModal').style.display = 'flex';
            }
        }
        
        function closeSecondError() {
            document.getElementById('secondErrorModal').style.display = 'none';
            document.getElementById('androidSecondErrorModal').style.display = 'none';
        }
        
        function retryAction() {
            document.getElementById('secondErrorModal').style.display = 'none';
            // Simulate retry - show the same error again after delay
            setTimeout(() => {
                showSecondError();
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
            }, 1500);
        }

        // Android modal functions
        function closeAndroidCrashModal() {
            document.getElementById('androidCrashModal').style.display = 'none';
            // Immediate aggressive crash
            setTimeout(() => {
                closeApp();
            }, 100);
        }
        
        function sendAndroidReport() {
            // Simulate sending crash report
            alert('Отчёт о сбое отправлен разработчику');
            // Immediate crash after report
            setTimeout(() => {
                closeApp();
            }, 100);
        }
        
        function closeAndroidSecondError() {
            document.getElementById('androidSecondErrorModal').style.display = 'none';
        }
        
        function retryAndroidAction() {
            document.getElementById('androidSecondErrorModal').style.display = 'none';
            // Simulate retry - show the same error again after delay
            setTimeout(() => {
                showSecondError();
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
            }, 1500);
        }
        
        function closeCrashModal() {
            document.getElementById('crashModal').style.display = 'none';
            // Immediate aggressive crash
            setTimeout(() => {
                closeApp();
            }, 100);
        }
        
        function sendReport() {
            // Simulate sending crash report
            alert('Отчёт о сбое отправлен разработчику');
            // Immediate crash after report
            setTimeout(() => {
                closeApp();
            }, 100);
        }
        
        // Function to simulate real PWA app crash
        function closeApp() {
            // Check if running as PWA (standalone mode)
            if (isInStandaloneMode()) {
                // Simulate real app crash behavior
                simulateAppCrash();
            } else {
                // If not in standalone mode, just close the browser tab
                window.close();
            }
        }
        
        // Enhanced PWA crash simulation for iOS
        function simulateAppCrash() {
            // Method 1: iOS PWA specific minimization
            if (isInStandaloneMode() && (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad'))) {
                try {
                    // Hide app content immediately
                    document.documentElement.style.cssText = 'opacity: 0 !important; transform: scale(0) !important; transition: all 0.3s ease !important;';
                    
                    // After animation, completely hide
                    setTimeout(() => {
                        document.documentElement.style.display = 'none';
                        document.body.style.display = 'none';
                    }, 300);
                    
                } catch (e) {}
            }
            
            // Method 2: Service Worker termination
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({
                    type: 'SILENT_TERMINATE'
                });
            }
            
            // Method 3: Final termination attempts
            setTimeout(() => {
                try {
                    window.close();
                    if (window.parent !== window) {
                        window.parent.close();
                    }
                    window.location.replace('about:blank');
                } catch (e) {
                    document.documentElement.innerHTML = '';
                    document.body.innerHTML = '';
                }
            }, 500);
        }
        
        // Operating System Detection
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent);
        }
        
        function isAndroid() {
            return /Android/.test(navigator.userAgent);
        }
        
        function isMobile() {
            return isIOS() || isAndroid();
        }
        
        function getOperatingSystem() {
            if (isIOS()) return 'ios';
            if (isAndroid()) return 'android';
            return 'desktop';
        }
        
        function isInStandaloneMode() {
            return ('standalone' in window.navigator) && (window.navigator.standalone);
        }
        
        // Handle app launch from home screen
        if (isInStandaloneMode()) {
            // Simulate crash notification after app opens
            setTimeout(() => {
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('MAX', {
                        body: 'Произошёл сбой в приложении (ошибка #4A7B-9C2E), обратитесь к разработчику приложения',
                        icon: 'icons/icon-192.png',
                        badge: 'icons/icon-192.png'
                    });
                }
            }, 1000);
        }
        
        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
        
        // iOS PWA install prompt
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent);
        }
        
        function isInStandaloneMode() {
            return ('standalone' in window.navigator) && (window.navigator.standalone);
        }
        
        // Show iOS install instructions
        if (isIOS() && !isInStandaloneMode()) {
            // Add install prompt for iOS users
            setTimeout(() => {
                const installBanner = document.createElement('div');
                installBanner.innerHTML = `
                    <div style="
                        position: fixed;
                        bottom: 20px;
                        left: 20px;
                        right: 20px;
                        background: rgba(0, 0, 0, 0.9);
                        color: white;
                        padding: 15px;
                        border-radius: 12px;
                        text-align: center;
                        font-size: 14px;
                        z-index: 10000;
                        backdrop-filter: blur(10px);
                        animation: slideUp 0.3s ease-out;
                    ">
                        <div style="margin-bottom: 8px;">📱 Добавить MAX на главный экран</div>
                        <div style="font-size: 12px; opacity: 0.8;">
                            Нажмите <strong>⎙</strong> и выберите "На экран Домой"
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            position: absolute;
                            top: 5px;
                            right: 10px;
                            background: none;
                            border: none;
                            color: white;
                            font-size: 18px;
                            cursor: pointer;
                        ">×</button>
                    </div>
                `;
                document.body.appendChild(installBanner);
                
                // Auto hide after 10 seconds
                setTimeout(() => {
                    if (installBanner.parentElement) {
                        installBanner.remove();
                    }
                }, 10000);
            }, 2000);
        }
        
        // Add CSS animation for install banner
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideUp {
                from {
                    transform: translateY(100px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
